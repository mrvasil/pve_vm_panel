{% extends "base.html" %}

{% block content %}
<header class="hero">
    <div>
        <div class="eyebrow">Proxmox VE</div>
        <h1>Dathomir admin panel</h1>
        <!-- <p class="lead">Name it, pick a preset, and the VM appears with cloud-init and DHCP.</p> -->
        {% if auth_enabled %}
        <a class="ghost auth-logout" href="{{ url_for('logout') }}">Logout</a>
        {% endif %}
    </div>
</header>

<div class="tab-bar">
    <button class="tab-btn" type="button" data-tab="manage">Manage VMs</button>
    <button class="tab-btn active" type="button" data-tab="create">Create VM</button>
</div>

<section class="grid" id="tab-create">
    <div class="hero-card create-meta is-subtle">
        <div class="hero-card__row">
            <span class="hero-card__label">Template</span>
            <span class="hero-card__value">VM {{ template_vmid }}</span>
        </div>
        <div class="hero-card__row">
            <span class="hero-card__label">Storage</span>
            <span class="hero-card__value">{{ storage }}</span>
        </div>
        <div class="hero-card__row">
            <span class="hero-card__label">Network</span>
            <span class="hero-card__value">DHCP</span>
        </div>
    </div>
    <div class="panel form-panel">
        <form id="create-form">
            <div class="field">
                <label for="vm-name">VM name</label>
                <input id="vm-name" name="vm_name" type="text" placeholder="project-alpha" required>
            </div>

            <div class="field split">
                <div>
                    <label for="username">Login</label>
                    <input id="username" name="username" type="text" value="{{ default_username }}">
                </div>
                <div>
                    <label for="password">Password</label>
                    <div class="inline">
                        <input id="password" name="password" type="text" placeholder="Auto-generate">
                        <button class="ghost" type="button" id="gen-pass">Generate</button>
                    </div>
                </div>
            </div>

            <div class="field">
                <label>Preset</label>
                <div class="preset-grid">
                    {% for preset in presets %}
                    <label class="preset-card">
                        <input type="radio" name="preset" value="{{ preset.id }}" {% if loop.first %}checked{% endif %}>
                        <div class="preset-body">
                            <div class="preset-title">{{ preset.label }}</div>
                            <div class="preset-note">{{ preset.note }}</div>
                            <div class="preset-specs">
                                <span>{{ preset.cores }} vCPU</span>
                                <span>{{ (preset.memory_mb // 1024) }} GB RAM</span>
                                <span>{{ preset.disk_gb }} GB disk</span>
                            </div>
                        </div>
                    </label>
                    {% endfor %}
                </div>
            </div>

            <button class="primary" type="submit" id="submit-btn">Create VM</button>
        </form>
    </div>

    <div class="panel status-panel">
        <div class="status-header">
            <h2>Provisioning</h2>
            <div class="status-pill" id="status-pill">Idle</div>
        </div>
        <div class="steps" id="steps"></div>

        <div class="result-card">
            <div class="result-row">
                <span class="result-label">Name</span>
                <span class="result-value" id="result-name">-</span>
            </div>
            <div class="result-row">
                <span class="result-label">VMID</span>
                <span class="result-value" id="result-vmid">-</span>
            </div>
            <div class="result-row">
                <span class="result-label">IP</span>
                <span class="result-value" id="result-ip">-</span>
            </div>
            <div class="result-row">
                <span class="result-label">Login</span>
                <span class="result-value" id="result-user">-</span>
            </div>
            <div class="result-row">
                <span class="result-label">Password</span>
                <span class="result-value mono" id="result-pass">-</span>
            </div>
        </div>

        <div class="result-actions">
            <button class="ghost" type="button" id="copy-password" disabled>Copy password</button>
        </div>

        <div class="error-box" id="error-box"></div>
    </div>
</section>

<section class="manage" id="tab-manage" hidden>

    <div class="manage-grid">
        <div class="panel vm-list-panel">
            <div class="vm-list" id="vm-list"></div>
        </div>

        <div class="panel vm-details-panel">
            <div class="vm-details-empty" id="vm-empty">Select a VM to manage it.</div>
            <div class="vm-details" id="vm-details" hidden>
                <div class="vm-details-header">
                    <div>
                        <div class="vm-details-eyebrow">Selected VM</div>
                        <h2 id="vm-title">-</h2>
                        <div class="vm-meta" id="vm-meta">-</div>
                    </div>
                    <div class="vm-actions">
                        <button class="ghost btn-icon" type="button" id="vm-start">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M8 5.5v13l10-6.5-10-6.5z"/></svg>
                            Start
                        </button>
                        <button class="ghost btn-icon" type="button" id="vm-reboot">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 6a6 6 0 1 1-5.2 3H4l3.5-4 3.5 4H8.8A4 4 0 1 0 12 8V6z"/></svg>
                            Reboot
                        </button>
                        <button class="ghost btn-icon" type="button" id="vm-stop">
                            <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M7 7h10v10H7z"/></svg>
                            Stop
                        </button>
                    </div>
                </div>

                <form id="vm-update-form">
                    <div class="field split">
                        <div>
                            <label for="vm-username">Username</label>
                            <input id="vm-username" name="ciuser" type="text" placeholder="ubuntu">
                        </div>
                        <div>
                            <label for="vm-password">Password</label>
                            <div class="inline">
                                <input id="vm-password" name="cipassword" type="text" placeholder="Leave empty to keep">
                                <button class="ghost" type="button" id="vm-gen-pass">Generate</button>
                            </div>
                        </div>
                    </div>

                    <div class="field split">
                        <div>
                            <label for="vm-cores">CPU cores</label>
                            <input id="vm-cores" name="cores" type="text" inputmode="numeric" placeholder="4">
                        </div>
                        <div>
                            <label for="vm-ram">RAM (GB)</label>
                            <input id="vm-ram" name="memory_gb" type="text" inputmode="decimal" placeholder="4">
                        </div>
                    </div>

                    <div class="field split">
                        <div>
                            <label for="vm-disk-add">Add disk space (GB)</label>
                            <input id="vm-disk-add" name="disk_add_gb" type="text" inputmode="decimal" placeholder="10">
                            <div class="hint" id="vm-disk-current">Current: -</div>
                        </div>
                        <div>
                            <label for="vm-net-bridge">Network bridge</label>
                            <div class="inline">
                                <select id="vm-net-iface" name="net_iface"></select>
                                <select id="vm-net-bridge" name="net_bridge"></select>
                            </div>
                            <div class="hint" id="vm-net-current">Current: -</div>
                        </div>
                    </div>

                    <button class="primary" type="submit" id="vm-save">Apply changes</button>
                    <div class="error-box" id="vm-update-error"></div>
                </form>
            </div>
        </div>
    </div>
</section>
{% endblock %}
